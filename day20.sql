with recursive aoc20_input(i) as (select '
#############################################################################################################################################
#.....#.........#...#...#.........###.....###...#.......#...###...#.......###...#...#.....#...###.....#...###...###...#.......#...#...###...#
#.###.#.#######.#.#.#.#.#.#######.###.###.###.#.#.#####.#.#.###.#.#.#####.###.#.#.#.#.###.#.#.###.###.#.#.###.#.###.#.#.#####.#.#.#.#.###.#.#
#...#.#...#...#...#...#...#.....#...#...#.....#.#.#.....#.#.#...#.#.#.....#...#...#.#...#.#.#...#...#...#...#.#.#...#.#.#.....#.#.#.#.....#.#
###.#.###.#.#.#############.###.###.###.#######.#.#.#####.#.#.###.#.#.#####.#######.###.#.#.###.###.#######.#.#.#.###.#.#.#####.#.#.#######.#
#...#...#.#.#...#...#.......###...#...#...#.....#.#.#...#.#.#.#...#.#.....#.....#...#...#.#...#.###.#.......#.#.#...#.#.#.....#.#.#.#.....#.#
#.#####.#.#.###.#.#.#.###########.###.###.#.#####.#.#.#.#.#.#.#.###.#####.#####.#.###.###.###.#.###.#.#######.#.###.#.#.#####.#.#.#.#.###.#.#
#...#...#...###...#...#.....#.....#...#...#.....#.#.#.#.#.#.#.#.....#.....#...#.#.###...#.#...#...#.#...#...#.#.#...#.#...#...#.#...#...#...#
###.#.#################.###.#.#####.###.#######.#.#.#.#.#.#.#.#######.#####.#.#.#.#####.#.#.#####.#.###.#.#.#.#.#.###.###.#.###.#######.#####
#...#...#...#...#...###...#.#.....#.#...#.......#.#.#.#.#.#.#.#.......#.....#.#.#...###.#.#.#...#...#...#.#.#.#...#...###.#...#...#.....#...#
#.#####.#.#.#.#.#.#.#####.#.#####.#.#.###.#######.#.#.#.#.#.#.#.#######.#####.#.###.###.#.#.#.#.#####.###.#.#.#####.#####.###.###.#.#####.#.#
#.#.....#.#...#.#.#.#...#.#.#.....#.#.#...#...###.#...#...#...#.#...###.#.....#.#...#...#.#...#.....#.###.#.#.....#.#...#.#...#...#.....#.#.#
#.#.#####.#####.#.#.#.#.#.#.#.#####.#.#.###.#.###.#############.#.#.###.#.#####.#.###.###.#########.#.###.#.#####.#.#.#.#.#.###.#######.#.#.#
#.#.#...#.....#...#.#.#.#.#.#.....#.#.#.###.#.#...#...#.........#.#.#...#.....#.#...#...#...#...#...#.#...#.#...#.#.#.#.#.#.....#.....#...#.#
#.#.#.#.#####.#####.#.#.#.#.#####.#.#.#.###.#.#.###.#.#.#########.#.#.#######.#.###.###.###.#.#.#.###.#.###.#.#.#.#.#.#.#.#######.###.#####.#
#.#...#.#...#.#.....#.#.#.#.#...#.#.#.#.#...#...#...#...#...#...#.#.#.....#...#.#...###...#.#.#.#...#.#.#...#.#...#...#...#.......###.......#
#.#####.#.#.#.#.#####.#.#.#.#.#.#.#.#.#.#.#######.#######.#.#.#.#.#.#####.#.###.#.#######.#.#.#.###.#.#.#.###.#############.#################
#.....#.#.#...#.....#.#...#.#.#...#...#.#.#.......#...###.#...#.#.#...#...#...#.#...#...#.#.#.#.#...#.#.#.#...#...#...#...#.#...#.....#.....#
#####.#.#.#########.#.#####.#.#########.#.#.#######.#.###.#####.#.###.#.#####.#.###.#.#.#.#.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.#.#.###.#.###.#
###...#.#.........#.#.....#.#.........#.#.#...#...#.#...#.....#.#.#...#.....#.#.#...#.#...#.#.#.#...#.#.#...#...#...#...#...#.#...#...#...#.#
###.###.#########.#.#####.#.#########.#.#.###.#.#.#.###.#####.#.#.#.#######.#.#.#.###.#####.#.#.###.#.#.#####.###############.#####.#####.#.#
#...#...#...#...#.#.#...#.#...#.......#...#...#.#...#...###...#.#.#...#.....#...#...#...#...#.#.#...#.#...#...###...###...###.#.....#.....#.#
#.###.###.#.#.#.#.#.#.#.#.###.#.###########.###.#####.#####.###.#.###.#.###########.###.#.###.#.#.###.###.#.#####.#.###.#.###.#.#####.#####.#
#...#...#.#.#.#...#.#.#.#.#...#...........#...#...#...#...#...#.#.#...#.........#...#...#.#...#.#.#...#...#.....#.#.#...#.....#.....#.#.....#
###.###.#.#.#.#####.#.#.#.#.#############.###.###.#.###.#.###.#.#.#.###########.#.###.###.#.###.#.#.###.#######.#.#.#.#############.#.#.#####
###...#...#...#...#...#.#.#.#.....###...#.#...#...#...#.#.#...#...#...###...###.#.#...#...#...#...#...#...#.....#.#.#.#...#...#...#...#.....#
#####.#########.#.#####.#.#.#.###.###.#.#.#.###.#####.#.#.#.#########.###.#.###.#.#.###.#####.#######.###.#.#####.#.#.#.#.#.#.#.#.#########.#
#...#.....#.....#.....#.#.#.#...#.#...#...#...#.#...#.#.#.#.........#.#...#.#...#.#...#.#...#...#.....#...#...###.#.#.#.#...#.#.#.#...#.....#
#.#.#####.#.#########.#.#.#.###.#.#.#########.#.#.#.#.#.#.#########.#.#.###.#.###.###.#.#.#.###.#.#####.#####.###.#.#.#.#####.#.#.#.#.#.#####
#.#.......#.#.......#.#.#.#...#.#.#.......#...#.#.#...#.#...###...#.#.#...#.#...#.#...#...#.#...#.#...#.#...#.#...#...#...###...#...#.#.....#
#.#########.#.#####.#.#.#.###.#.#.#######.#.###.#.#####.###.###.#.#.#.###.#.###.#.#.#######.#.###.#.#.#.#.#.#.#.#########.###########.#####.#
#.........#.#.#...#...#.#.#...#.#.#...#...#.#...#.#...#.#...#...#.#.#.#...#.#...#...#.......#...#.#.#.#.#.#...#.#.......#...........#.......#
#########.#.#.#.#.#####.#.#.###.#.#.#.#.###.#.###.#.#.#.#.###.###.#.#.#.###.#.#######.#########.#.#.#.#.#.#####.#.#####.###########.#########
#.........#.#...#.....#.#.#.#...#...#.#...#.#...#.#.#.#.#.###...#.#.#.#.#...#.......#.#...#...#.#.#.#.#.#.###...#.....#.#...#.......###.....#
#.#########.#########.#.#.#.#.#######.###.#.###.#.#.#.#.#.#####.#.#.#.#.#.#########.#.#.#.#.#.#.#.#.#.#.#.###.#######.#.#.#.#.#########.###.#
#.........#.#.........#...#.#.......#...#.#.#...#...#.#.#...#...#.#.#.#.#...#...#...#.#.#.#.#.#.#.#.#...#.....#.....#.#...#...#.......#.#...#
#########.#.#.#############.#######.###.#.#.#.#######.#.###.#.###.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.###########.###.#.#########.#####.#.#.###
#.........#.#.............#.#...###.###...#...###...#.#.#...#...#.#.#.#.#...#.#...###.#.#.#.#.#.#.#.#.........#...#...#...#...#.#...#...#...#
#.#########.#############.#.#.#.###.#############.#.#.#.#.#####.#.#.#.#.#.###.#######.#.#.#.#.#.#.#.#.#######.###.#####.#.#.#.#.#.#.#######.#
#...........###...#...#...#...#.....#.............#.#.#.#.#...#.#...#...#...#.......#.#.#.#.#.#.#.#.#.......#.....#.....#...#...#.#.........#
###############.#.#.#.#.#############.#############.#.#.#.#.#.#.###########.#######.#.#.#.#.#.#.#.#.#######.#######.#############.###########
#.....#...#.....#...#...#...#...#.....#.......#.....#.#.#.#.#.#.....#.......#...#...#...#...#.#.#...#...#...#...###.#.........#...#...#...###
#.###.#.#.#.#############.#.#.#.#.#####.#####.#.#####.#.#.#.#.#####.#.#######.#.#.###########.#.#####.#.#.###.#.###.#.#######.#.###.#.#.#.###
#...#.#.#.#.........#...#.#.#.#...#...#.....#.#...###.#.#...#.#...#.#...#.....#.#...........#.#.#.....#...###.#.#...#.......#...#...#...#...#
###.#.#.#.#########.#.#.#.#.#.#####.#.#####.#.###.###.#.#####.#.#.#.###.#.#####.###########.#.#.#.###########.#.#.#########.#####.#########.#
#...#...#.#.........#.#...#...###...#.......#...#...#.#.....#.#.#.#.###.#.#...#.#.......#...#...#.#.........#.#...#...#...#.....#.#.........#
#.#######.#.#########.###########.#############.###.#.#####.#.#.#.#.###.#.#.#.#.#.#####.#.#######.#.#######.#.#####.#.#.#.#####.#.#.#########
#.......#.#.......#...#.........#.............#...#.#.#...#.#.#.#...#...#...#.#.#...###.#.......#.#.#.......#.#.....#...#.#.....#.#.#...#...#
#######.#.#######.#.###.#######.#############.###.#.#.#.#.#.#.#.#####.#######.#.###.###.#######.#.#.#.#######.#.#########.#.#####.#.#.#.#.#.#
#...###.#.#...#...#.###.......#.........#...#...#.#.#.#.#.#.#.#.#.....#.......#.#...#...#...#...#...#.........#...#.....#...#.....#...#...#.#
#.#.###.#.#.#.#.###.#########.#########.#.#.###.#.#.#.#.#.#.#.#.#.#####.#######.#.###.###.#.#.###################.#.###.#####.#############.#
#.#.....#...#.#...#.#.....#...#.......#.#.#.#...#.#.#.#.#.#.#.#.#.#...#.......#.#...#...#.#...###...#...#...#.....#.#...#...#.#.....#...#...#
#.###########.###.#.#.###.#.###.#####.#.#.#.#.###.#.#.#.#.#.#.#.#.#.#.#######.#.###.###.#.#######.#.#.#.#.#.#.#####.#.###.#.#.#.###.#.#.#.###
#...#.....#...###...#...#...#...#.....#...#...###...#...#...#...#.#.#.....#...#.#...###.#...#.....#...#...#.#.......#.....#...#...#.#.#.#.###
###.#.###.#.###########.#####.###.###############################.#.#####.#.###.#.#####.###.#.#############.#####################.#.#.#.#.###
#...#.#...#.#.......###...#...###...........###...........#.......#...#...#.###.#.....#.....#.............#.......#.....#...#.....#.#.#.#...#
#.###.#.###.#.#####.#####.#.###############.###.#########.#.#########.#.###.###.#####.###################.#######.#.###.#.#.#.#####.#.#.###.#
#.....#...#.#...#...#...#...###...#.......#.....#.........#.#.....#...#...#...#.#.....###...#...#...#...#.......#.#...#.#.#.#.....#.#.#.#...#
#########.#.###.#.###.#.#######.#.#.#####.#######.#########.#.###.#.#####.###.#.#.#######.#.#.#.#.#.#.#.#######.#.###.#.#.#.#####.#.#.#.#.###
#.........#...#.#...#.#.#.......#...#...#.......#.........#...###...#####...#.#.#.#.......#...#...#.#.#.#...#...#.#...#.#.#.......#...#.#.###
#.###########.#.###.#.#.#.###########.#.#######.#########.#################.#.#.#.#.###############.#.#.#.#.#.###.#.###.#.#############.#.###
#.#.........#...#...#.#.#...........#.#.#.....#.#.........#.....#...###.....#.#...#.#.............#...#...#...###...#...#.........###...#...#
#.#.#######.#####.###.#.###########.#.#.#.###.#.#.#########.###.#.#.###.#####.#####.#.###########.###################.###########.###.#####.#
#.#.#.....#.....#.###.#.###.......#...#...#...#...###...###...#...#...#...#...#...#.#.#.........#...................#...#...#...#...#.......#
#.#.#.###.#####.#.###.#.###.#####.#########.#########.#.#####.#######.###.#.###.#.#.#.#.#######.###################.###.#.#.#.#.###.#########
#...#...#.......#...#.#.#...#...#.#...#...#.........#.#.#...#.#...#...###...#...#.#...#.......#.....................###...#...#.....#.......#
#######.###########.#.#.#.###.#.#.#.#.#.#.#########.#.#.#.#.#.#.#.#.#########.###.###########.#######################################.#####.#
#...###...........#...#...#...#.#...#...#...#.....#...#...#.#.#.#...###.......#...#.....#...#.....#...........#...###...#...#...#...#.#.....#
#.#.#############.#########.###.###########.#.###.#########.#.#.#######.#######.###.###.#.#.#####.#.#########.#.#.###.#.#.#.#.#.#.#.#.#.#####
#.#.#.............#.....#...###...........#.#...#...#.....#...#.......#...#...#...#...#.#.#.#...#...#.........#.#.....#...#...#...#...#.....#
#.#.#.#############.###.#.###############.#.###.###.#.###.###########.###.#.#.###.###.#.#.#.#.#.#####.#########.###########################.#
#.#.#...........#...###...#...........#...#...#.###...###.#...#.......#...#.#...#.#...#...#...#.#.....#.........#.....#.....#.........#.....#
#.#.###########.#.#########.#########.#.#####.#.#########.#.#.#.#######.###.###.#.#.###########.#.#####.#########.###.#.###.#.#######.#.#####
#.#...###...###.#.#.......#.........#...#...#...#...#...#...#.#.......#.#...###.#...#......E#...#.#.....#...#.....###...#...#.......#.#.....#
#.###.###.#.###.#.#.#####.#########.#####.#.#####.#.#.#.#####.#######.#.#.#####.#####.#######.###.#.#####.#.#.###########.#########.#.#####.#
#...#.#...#...#...#...#...#...#...#.......#.......#...#.....#...#.....#...###...#...#.#######...#...#.....#.#...#.......#...#...#...#...#...#
###.#.#.#####.#######.#.###.#.#.#.#########################.###.#.###########.###.#.#.#########.#####.#####.###.#.#####.###.#.#.#.#####.#.###
#...#.#...#...###.....#.#...#...#.............#...#...#...#...#...###...#...#.....#...#########.......#####...#...#.....###...#...###...#...#
#.###.###.#.#####.#####.#.###################.#.#.#.#.#.#.###.#######.#.#.#.#################################.#####.#################.#####.#
#...#.....#.....#.....#...#.....#.......#...#...#...#...#...#...#...#.#.#.#.....#############################.#.....#...#...........#.#.....#
###.###########.#####.#####.###.#.#####.#.#.###############.###.#.#.#.#.#.#####.#############################.#.#####.#.#.#########.#.#.#####
###...#...#...#...#...#...#.###...#.....#.#.............#...#...#.#...#.#...#...#############################...#...#.#...#...#...#.#.#.....#
#####.#.#.#.#.###.#.###.#.#.#######.#####.#############.#.###.###.#####.###.#.###################################.#.#.#####.#.#.#.#.#.#####.#
#.....#.#...#...#...#...#...#...###.......#...#.....#...#.....###.....#.....#...#...#######################...###.#.#.#.....#.#.#.#.#.#.....#
#.#####.#######.#####.#######.#.###########.#.#.###.#.###############.#########.#.#.#######################.#.###.#.#.#.#####.#.#.#.#.#.#####
#.#.....#...###...#...#...###.#.#.....#.....#...#...#...#...#####...#.......#...#.#.#.....#################.#.#...#.#.#.#...#...#.#.#.#.....#
#.#.#####.#.#####.#.###.#.###.#.#.###.#.#########.#####.#.#.#####.#.#######.#.###.#.#.###.#################.#.#.###.#.#.#.#.#####.#.#.#####.#
#.#.#.....#.......#.#...#.....#.#...#.#.........#.......#.#...#...#...#.....#.#...#.#...#.###...#.......#S..#...#...#.#...#...###.#.#...#...#
#.#.#.#############.#.#########.###.#.#########.#########.###.#.#####.#.#####.#.###.###.#.###.#.#.#####.#########.###.#######.###.#.###.#.###
#...#.........#.....#.#...#...#.....#.#.......#...###...#.#...#.....#...#...#.#...#...#.#.#...#.#.....#.#...#...#.....#.....#...#...###...###
#############.#.#####.#.#.#.#.#######.#.#####.###.###.#.#.#.#######.#####.#.#.###.###.#.#.#.###.#####.#.#.#.#.#.#######.###.###.#############
#.............#.#.....#.#.#.#.......#.#.....#.....#...#...#.....###...#...#.#.###...#.#.#.#...#.#.....#...#...#...#...#...#...#...###.......#
#.#############.#.#####.#.#.#######.#.#####.#######.###########.#####.#.###.#.#####.#.#.#.###.#.#.###############.#.#.###.###.###.###.#####.#
#...#...#...#...#.....#.#.#.#.......#.....#.......#.......#...#.#...#...#...#.#...#.#...#...#.#.#.....#...#.....#...#.#...###...#...#.#.....#
###.#.#.#.#.#.#######.#.#.#.#.###########.#######.#######.#.#.#.#.#.#####.###.#.#.#.#######.#.#.#####.#.#.#.###.#####.#.#######.###.#.#.#####
###...#...#...#...###...#...#...........#.........#...#...#.#...#.#.#...#...#.#.#.#.....#...#.#.....#...#...#...#...#...#...###...#...#.....#
###############.#.#####################.###########.#.#.###.#####.#.#.#.###.#.#.#.#####.#.###.#####.#########.###.#.#####.#.#####.#########.#
#...###.......#.#.#...###...............###...#...#.#.#...#...###.#.#.#.#...#...#.....#.#...#.#...#...###...#.....#.......#...###.#...#...#.#
#.#.###.#####.#.#.#.#.###.#################.#.#.#.#.#.###.###.###.#.#.#.#.###########.#.###.#.#.#.###.###.#.#################.###.#.#.#.#.#.#
#.#.#...#...#...#...#...#...............#...#.#.#.#.#...#.#...#...#...#.#...#.........#.#...#...#.#...#...#...#.........#...#...#...#.#.#...#
#.#.#.###.#.###########.###############.#.###.#.#.#.###.#.#.###.#######.###.#.#########.#.#######.#.###.#####.#.#######.#.#.###.#####.#.#####
#.#...#...#...#...#...#.....###...#.....#...#...#.#...#...#.###.....#...#...#.#.....#...#...#.....#...#.....#.#.......#.#.#.#...#...#.#.....#
#.#####.#####.#.#.#.#.#####.###.#.#.#######.#####.###.#####.#######.#.###.###.#.###.#.#####.#.#######.#####.#.#######.#.#.#.#.###.#.#.#####.#
#.......#...#...#...#.#...#.....#...###...#.#.....###...#...#...###.#.###...#.#.#...#...#...#.....#...###...#.#...#...#.#.#.#.....#.#...#...#
#########.#.#########.#.#.#############.#.#.#.#########.#.###.#.###.#.#####.#.#.#.#####.#.#######.#.#####.###.#.#.#.###.#.#.#######.###.#.###
###...#...#.........#...#...#...#.....#.#.#.#.#.....#...#...#.#.#...#.#.....#.#.#...#...#.#...#...#...#...###...#...###...#.......#...#.#...#
###.#.#.###########.#######.#.#.#.###.#.#.#.#.#.###.#.#####.#.#.#.###.#.#####.#.###.#.###.#.#.#.#####.#.#########################.###.#.###.#
#...#...#.........#.###.....#.#.#...#.#.#...#.#.###...###...#.#...#...#.....#.#.#...#...#.#.#.#...#...#.............#...........#.....#.....#
#.#######.#######.#.###.#####.#.###.#.#.#####.#.#########.###.#####.#######.#.#.#.#####.#.#.#.###.#.###############.#.#########.#############
#.#.....#.#.......#.....#...#.#.#...#.#.#.....#.....#...#...#.....#...#.....#.#.#.#...#.#.#.#...#.#.#...#...........#.#.......#.....###.....#
#.#.###.#.#.#############.#.#.#.#.###.#.#.#########.#.#.###.#####.###.#.#####.#.#.#.#.#.#.#.###.#.#.#.#.#.###########.#.#####.#####.###.###.#
#.#.#...#.#...#...#.....#.#.#.#...#...#.#.....#...#...#...#...#...#...#.....#...#...#.#.#...#...#.#.#.#.#.............#...###.#...#...#.#...#
#.#.#.###.###.#.#.#.###.#.#.#.#####.###.#####.#.#.#######.###.#.###.#######.#########.#.#####.###.#.#.#.#################.###.#.#.###.#.#.###
#.#.#...#.###.#.#.#.#...#.#.#.#.....#...#.....#.#.#.......#...#.#...#.......#.........#.....#...#.#.#.#.#...#.......#...#...#...#...#...#...#
#.#.###.#.###.#.#.#.#.###.#.#.#.#####.###.#####.#.#.#######.###.#.###.#######.#############.###.#.#.#.#.#.#.#.#####.#.#.###.#######.#######.#
#.#.#...#...#.#.#.#.#...#.#.#.#...#...###.....#.#.#.......#.....#...#.......#...#.....#...#.###...#.#.#.#.#.#.....#...#...#...#...#.......#.#
#.#.#.#####.#.#.#.#.###.#.#.#.###.#.#########.#.#.#######.#########.#######.###.#.###.#.#.#.#######.#.#.#.#.#####.#######.###.#.#.#######.#.#
#...#...#...#...#...###.#.#.#.#...#.....#.....#.#.#...#...#.........#.......###.#...#.#.#...#.......#.#...#.#...#.......#...#...#.......#.#.#
#######.#.#############.#.#.#.#.#######.#.#####.#.#.#.#.###.#########.#########.###.#.#.#####.#######.#####.#.#.#######.###.###########.#.#.#
#.......#...###.........#.#.#.#...#...#.#.#...#.#...#.#...#...#.....#.......#...#...#.#.....#.#.....#.....#.#.#.........###...#.........#...#
#.#########.###.#########.#.#.###.#.#.#.#.#.#.#.#####.###.###.#.###.#######.#.###.###.#####.#.#.###.#####.#.#.###############.#.#############
#.......#...#...#...#...#.#.#...#.#.#...#...#.#.....#.....###.#.#...#...#...#.#...###.#.....#...###...#...#.#...........###...#.............#
#######.#.###.###.#.#.#.#.#.###.#.#.#########.#####.#########.#.#.###.#.#.###.#.#####.#.#############.#.###.###########.###.###############.#
#...#...#.#...#...#.#.#.#.#...#.#.#.###.......#...#.........#.#.#...#.#...#...#.#.....#.......#.......#...#...#.......#...#...#.....#...#...#
#.#.#.###.#.###.###.#.#.#.###.#.#.#.###.#######.#.#########.#.#.###.#.#####.###.#.###########.#.#########.###.#.#####.###.###.#.###.#.#.#.###
#.#...#...#.#...#...#.#.#...#...#...#...#.....#.#.#.....#...#.#.#...#.....#...#.#.......#.....#...#...#...###.#.....#.#...###.#...#.#.#...###
#.#####.###.#.###.###.#.###.#########.###.###.#.#.#.###.#.###.#.#.#######.###.#.#######.#.#######.#.#.#.#####.#####.#.#.#####.###.#.#.#######
#.....#.###.#...#...#.#...#...###...#.....#...#.#.#.###...###.#.#...#...#.###...#.......#.......#.#.#.#.....#.#.....#.#.#.....#...#.#.....###
#####.#.###.###.###.#.###.###.###.#.#######.###.#.#.#########.#.###.#.#.#.#######.#############.#.#.#.#####.#.#.#####.#.#.#####.###.#####.###
#.....#...#...#.#...#.#...#...#...#.........#...#.#...#.....#...#...#.#.#.#.......#...#.....#...#...#.#.....#...#...#...#.....#.###.#...#...#
#.#######.###.#.#.###.#.###.###.#############.###.###.#.###.#####.###.#.#.#.#######.#.#.###.#.#######.#.#########.#.#########.#.###.#.#.###.#
#.#.....#...#.#.#.....#...#.###.......#...#...###...#...#...###...#...#.#.#.#.....#.#.#...#.#.....#...#...........#.........#.#...#.#.#...#.#
#.#.###.###.#.#.#########.#.#########.#.#.#.#######.#####.#####.###.###.#.#.#.###.#.#.###.#.#####.#.#######################.#.###.#.#.###.#.#
#.#.#...#...#...###.......#...###.....#.#.#.#.......#...#.....#...#...#.#.#...#...#.#.#...#.#.....#...#...#...#...#...#...#.#.#...#...###...#
#.#.#.###.#########.#########.###.#####.#.#.#.#######.#.#####.###.###.#.#.#####.###.#.#.###.#.#######.#.#.#.#.#.#.#.#.#.#.#.#.#.#############
#.#.#...#.###.......#...#...#.#...#...#.#.#.#.#...#...#.......#...#...#.#.....#.....#.#...#.#.......#...#...#.#.#.#.#...#.#.#.#.............#
#.#.###.#.###.#######.#.#.#.#.#.###.#.#.#.#.#.#.#.#.###########.###.###.#####.#######.###.#.#######.#########.#.#.#.#####.#.#.#############.#
#.#.#...#...#.#...#...#.#.#.#.#...#.#.#.#.#.#.#.#.#...........#.#...#...#...#.#.......#...#.#.....#.....#.....#.#.#...#...#.#.#...#...#...#.#
#.#.#.#####.#.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#.#.###########.#.#.###.###.#.#.#.#######.###.#.###.#####.#.#####.#.###.#.###.#.#.#.#.#.#.#.#.#
#...#.......#...#...###...#...###...#...#...#...#.............#...###.....#...#.........###...###.......#.......#.....#.....#...#...#...#...#
#############################################################################################################################################
'),
lines(y,line) as (
   select 0, substr(i,1,position(E'\n' in i)-1), substr(i,position(E'\n' in i)+1)
   from aoc20_input
   union all
   select y+1,substr(r,1,position(E'\n' in r)-1), substr(r,position(E'\n' in r)+1)
   from lines l(y,l,r) where position(E'\n' in r)>0
),
field(x,y,v) as (
   select x::smallint,y::smallint, substr(line,x::integer,1) as char
   from (select * from lines l where line<>'') s, lateral generate_series(1,length(line)) g(x)
),
maxlen(maxlen) as (select count(*) from field where v<>'#'),
directions(dx,dy) as (values(1::smallint,0::smallint),(0::smallint,1::smallint),(-1::smallint,0::smallint),(0::smallint,-1::smallint)),
floodstart(step,x,y) as (
   select 0::smallint, x, y, -1::smallint as lx, -1::smallint as ly from field where v='S'
   union all
   select distinct step+1::smallint, f.x, f.y, l.x, l.y from (floodstart l cross join directions) join field f on l.x+dx=f.x and l.y+dy=f.y, maxlen
   where v!='#' and (f.x<>lx or f.y<>ly) and step<maxlen
),
startdistances(x,y,d) as (select x,y, min(step) as d from floodstart group by x,y),
floodend(step,x,y) as (
   select 0::smallint, x, y, -1::smallint as lx, -1::smallint as ly  from field where v='E'
   union all
   select distinct (step+1)::smallint, f.x, f.y, l.x, l.y from (floodend l cross join directions) join field f on l.x+dx=f.x and l.y+dy=f.y, maxlen
   where v!='#' and (f.x<>lx or f.y<>ly) and step<maxlen
),
enddistances(x,y,d) as (select x,y, min(step) as d from floodend group by x,y),
regular(distance) as (select d from enddistances natural join field where v = 'S' limit 1),
cheated(startx, starty, endy, starty, cheatdistance) as (
   select s.x as startx, s.y as starty, e.x as endx, e.y as endy, abs(s.x-e.x)+abs(s.y-e.y) as cd
   from (startdistances s join regular r1 on s.d<=r1.distance-100),
        (enddistances e join regular r2 on e.d<=r2.distance-100)
   where s.x between e.x-20 and e.x+20 and s.y between e.y-20 and e.y+20 and (abs(s.x-e.x)+abs(s.y-e.y))<=20
   and r1.distance-(s.d+abs(s.x-e.x)+abs(s.y-e.y)+e.d) >= 100)
select (select count(*) from cheated where cheatdistance<=2) as part1,
       (select count(*) from cheated where cheatdistance<=20) as part2
